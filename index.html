<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>KT Demo</title>
	<link rel="stylesheet" href="styles.css">
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
	<header class="container mx-auto px-4 py-8">
		<h1 class="text-4xl font-bold text-center">KT</h1>
	</header>
	
	<div class="container mx-auto px-4 mb-12">
		<div class="max-w-2xl mx-auto text-center">
			<p class="text-lg text-gray-600">
				A simple and fast way for Kubernetes troubleshooting
			</p>
		</div>
	</div>
	
	<main class="container mx-auto px-4 flex flex-col items-center">
		<!-- GIF Demo Section -->
		<section class="mb-12 w-full max-w-5xl">
			<div class="mx-auto">
				<img src="./assets/demo.gif" alt="KT Demo Walkthrough" class="w-full rounded-lg shadow-lg min-h-[400px] object-cover">
			</div>
		</section>
		
		<!-- Email Subscription Section -->
		<section class="mb-12 w-full max-w-xl">
			<div class="bg-white rounded-lg shadow-lg p-8">
				<h2 class="text-1xl font-bold mb-4 text-center">Stay Updated</h2>
				<p class="text-gray-600 mb-6 text-center">Subscribe to new releases!</p>
				
				<form id="subscribeForm" class="flex flex-col items-center">
					<div class="w-full max-w-md mb-4">
						<input 
							type="email" 
							id="email" 
							name="email"
							placeholder="Enter your email" 
							class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
							required
							pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
						>
						<p id="emailError" class="text-red-500 text-sm mt-1 hidden"></p>
					</div>
					<button 
						type="submit"
						class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed"
						id="submitButton"
					>
						Subscribe
					</button>
					<p id="subscribeMessage" class="text-sm text-center mt-4 hidden"></p>
				</form>
			</div>
		</section>
	</main>

	<script>
		const emailInput = document.getElementById('email');
		const emailError = document.getElementById('emailError');
		const submitButton = document.getElementById('submitButton');
		const subscribeMessage = document.getElementById('subscribeMessage');

		function validateEmail(email) {
			// Regular expression for email validation
			const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
			return emailRegex.test(email);
		}

		function showError(message) {
			emailError.textContent = message;
			emailError.classList.remove('hidden');
			emailInput.classList.add('border-red-500');
		}

		function clearError() {
			emailError.classList.add('hidden');
			emailInput.classList.remove('border-red-500');
		}

		// Real-time validation
		emailInput.addEventListener('input', function(e) {
			const email = e.target.value.trim();
			
			if (email === '') {
				showError('Email is required');
				submitButton.disabled = true;
			} else if (!validateEmail(email)) {
				showError('Please enter a valid email address');
				submitButton.disabled = true;
			} else {
				clearError();
				submitButton.disabled = false;
			}
		});

		// Updated form submission
		document.getElementById('subscribeForm').addEventListener('submit', async function(e) {
			e.preventDefault();
			
			const email = emailInput.value.trim();
			
			// Disable submit button during submission
			submitButton.disabled = true;
			
			try {
				// Send to Formspree
				const response = await fetch('https://formspree.io/f/mkgnbwzn', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ email: email })
				});

				if (response.ok) {
					// Get existing emails from localStorage
					const emails = JSON.parse(localStorage.getItem('subscribedEmails') || '[]');
					
					// Add new email if not already present
					if (!emails.includes(email)) {
						emails.push(email);
						localStorage.setItem('subscribedEmails', JSON.stringify(emails));
						
						// Success message
						subscribeMessage.textContent = 'Thanks for subscribing!';
						subscribeMessage.classList.remove('hidden', 'text-red-500');
						subscribeMessage.classList.add('text-green-500');
						
						// Clear input
						emailInput.value = '';
					} else {
						// Already subscribed message
						subscribeMessage.textContent = 'This email is already subscribed!';
						subscribeMessage.classList.remove('hidden', 'text-green-500');
						subscribeMessage.classList.add('text-red-500');
					}
				} else {
					throw new Error('Subscription failed');
				}
			} catch (error) {
				console.error('Error:', error);
				subscribeMessage.textContent = 'Subscription failed. Please try again.';
				subscribeMessage.classList.remove('hidden', 'text-green-500');
				subscribeMessage.classList.add('text-red-500');
			} finally {
				// Re-enable submit button
				submitButton.disabled = false;
				
				// Hide message after 5 seconds
				setTimeout(() => {
					subscribeMessage.classList.add('hidden');
				}, 5000);
			}
		});

		// Optional: Function to get all subscribed emails
		function getSubscribedEmails() {
			return JSON.parse(localStorage.getItem('subscribedEmails') || '[]');
		}

		// Optional: Function to export emails to CSV
		function exportEmailsToCSV() {
			const emails = getSubscribedEmails();
			const csvContent = 'data:text/csv;charset=utf-8,' + emails.join('\n');
			const encodedUri = encodeURI(csvContent);
			const link = document.createElement('a');
			link.setAttribute('href', encodedUri);
			link.setAttribute('download', 'subscribed_emails.csv');
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
		}
	</script>
</body>
</html>
